<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Minnesota Dispersed Camping Finder</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.min.css" />
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            height: 100vh;
            overflow: hidden;
        }

        #map {
            height: 100vh;
            width: 100%;
        }

        .control-panel {
            position: absolute;
            top: 10px;
            right: 10px;
            background: white;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.2);
            z-index: 1000;
            max-width: 300px;
            max-height: 90vh;
            overflow-y: auto;
        }

        .control-panel h3 {
            margin-bottom: 12px;
            font-size: 16px;
            color: #2c5f2d;
            border-bottom: 2px solid #2c5f2d;
            padding-bottom: 8px;
        }

        .layer-group {
            margin-bottom: 15px;
        }

        .layer-group h4 {
            font-size: 13px;
            color: #555;
            margin-bottom: 8px;
            font-weight: 600;
        }

        .layer-item {
            display: flex;
            align-items: center;
            margin-bottom: 8px;
            font-size: 13px;
        }

        .layer-item input[type="checkbox"] {
            margin-right: 8px;
            cursor: pointer;
        }

        .layer-item label {
            cursor: pointer;
            flex: 1;
        }

        .legend-color {
            width: 16px;
            height: 16px;
            display: inline-block;
            margin-left: 5px;
            border: 1px solid #999;
            border-radius: 2px;
        }

        .weather-panel {
            position: absolute;
            bottom: 10px;
            left: 10px;
            background: white;
            padding: 12px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.2);
            z-index: 1000;
            min-width: 200px;
            display: none;
        }

        .weather-panel.active {
            display: block;
        }

        .weather-panel h4 {
            font-size: 14px;
            margin-bottom: 8px;
            color: #2c5f2d;
        }

        .weather-day {
            padding: 6px 0;
            border-bottom: 1px solid #eee;
            font-size: 12px;
        }

        .weather-day:last-child {
            border-bottom: none;
        }

        .title-banner {
            position: absolute;
            top: 10px;
            left: 10px;
            background: rgba(44, 95, 45, 0.95);
            color: white;
            padding: 12px 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.2);
            z-index: 1000;
        }

        .title-banner h1 {
            font-size: 18px;
            font-weight: 600;
        }

        .title-banner p {
            font-size: 11px;
            opacity: 0.9;
            margin-top: 4px;
        }

        .info-popup {
            font-size: 13px;
            line-height: 1.5;
        }

        .info-popup h4 {
            margin-bottom: 5px;
            color: #2c5f2d;
        }

        .info-popup p {
            margin: 3px 0;
        }

        .toggle-btn {
            background: #2c5f2d;
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            margin-top: 8px;
            width: 100%;
        }

        .toggle-btn:hover {
            background: #234a24;
        }

        .status-text {
            font-size: 10px;
            color: #666;
            margin-top: 8px;
            font-style: italic;
        }

        .legend-item {
            display: flex;
            align-items: center;
            font-size: 11px;
            margin: 4px 0;
            color: #666;
        }

        .leaflet-control-layers {
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.2);
        }

        .leaflet-control-layers-expanded {
            padding: 10px;
        }

        .camp-icon-known {
            font-size: 28px;
            filter: drop-shadow(0 2px 4px rgba(0,0,0,0.3));
        }

        .camp-icon-risky {
            font-size: 28px;
            filter: drop-shadow(0 2px 4px rgba(0,0,0,0.3));
        }

        @media (max-width: 768px) {
            .control-panel {
                max-width: 240px;
            }
            
            .title-banner h1 {
                font-size: 14px;
            }
        }
    </style>
</head>
<body>
    <div id="map"></div>
    
    <div class="title-banner">
        <h1>üèïÔ∏è Minnesota Dispersed Camping Finder</h1>
        <p>Research-verified sites + 60,000+ roads from OSM</p>
    </div>

    <div class="control-panel">
        <h3>üó∫Ô∏è Map Layers</h3>
        
        <div class="layer-group">
            <h4>Federal Lands</h4>
            <div class="layer-item">
                <input type="checkbox" id="layer-national-forest" checked>
                <label for="layer-national-forest">National Forests</label>
                <span class="legend-color" style="background: rgba(34, 139, 34, 0.3);"></span>
            </div>
            <div class="layer-item">
                <input type="checkbox" id="layer-wilderness">
                <label for="layer-wilderness">Wilderness Areas</label>
                <span class="legend-color" style="background: rgba(139, 0, 0, 0.2);"></span>
            </div>
        </div>

        <div class="layer-group">
            <h4>State Lands</h4>
            <div class="layer-item">
                <input type="checkbox" id="layer-state-forest" checked>
                <label for="layer-state-forest">State Forests</label>
                <span class="legend-color" style="background: rgba(60, 179, 113, 0.3);"></span>
            </div>
        </div>

        <div class="layer-group">
            <h4>Roads & Trails (OSM)</h4>
            <div class="layer-item">
                <input type="checkbox" id="layer-forest-roads" checked>
                <label for="layer-forest-roads">Forest Roads</label>
            </div>
            <div class="layer-item">
                <input type="checkbox" id="layer-tracks" checked>
                <label for="layer-tracks">4WD Tracks</label>
            </div>
            <div class="layer-item">
                <input type="checkbox" id="layer-paths">
                <label for="layer-paths">Hiking Trails</label>
            </div>
            <div class="legend-item">
                <span style="width: 20px; height: 2px; background: #8B4513; display: inline-block; margin-right: 5px;"></span>
                <span>Forest Roads</span>
            </div>
            <div class="legend-item">
                <span style="width: 20px; height: 2px; background: #A0522D; display: inline-block; margin-right: 5px; border-top: 2px dashed #A0522D;"></span>
                <span>4WD Tracks</span>
            </div>
            <div class="legend-item">
                <span style="width: 20px; height: 1px; background: #FF6347; display: inline-block; margin-right: 5px;"></span>
                <span>Trails</span>
            </div>
        </div>

        <div class="layer-group">
            <h4>Camping Sites</h4>
            <div class="layer-item">
                <input type="checkbox" id="layer-dispersed-known" checked>
                <label for="layer-dispersed-known">Known Dispersed Sites</label>
                <span style="font-size: 16px; margin-left: 5px;">‚õ∫</span>
            </div>
            <div class="layer-item">
                <input type="checkbox" id="layer-dispersed-risky">
                <label for="layer-dispersed-risky">Risky Dispersed Sites</label>
                <span style="font-size: 16px; margin-left: 5px;">‚ö†Ô∏è</span>
            </div>
            <div class="layer-item">
                <input type="checkbox" id="layer-campgrounds">
                <label for="layer-campgrounds">Campgrounds (OSM)</label>
            </div>
            <div class="legend-item" style="margin-top: 8px; padding: 6px; background: #f0f9ff; border-radius: 4px;">
                <span style="font-size: 18px; margin-right: 5px;">‚õ∫</span>
                <span style="font-size: 10px;"><strong>Known:</strong> Well-documented, frequently used</span>
            </div>
            <div class="legend-item" style="padding: 6px; background: #fff7ed; border-radius: 4px;">
                <span style="font-size: 18px; margin-right: 5px;">‚ö†Ô∏è</span>
                <span style="font-size: 10px;"><strong>Risky:</strong> Possible but limited info - verify first!</span>
            </div>
        </div>

        <div class="layer-group">
            <h4>Overlays</h4>
            <div class="layer-item">
                <input type="checkbox" id="layer-dark-sky">
                <label for="layer-dark-sky">Dark Sky Areas</label>
            </div>
        </div>

        <button class="toggle-btn" id="weather-toggle">Show Weather Forecast</button>
        <p class="status-text" id="status-text">Loading map data...</p>
    </div>

    <div class="weather-panel" id="weather-panel">
        <h4>‚õÖ 3-Day Forecast</h4>
        <div id="weather-content">
            <p style="font-size: 11px; color: #666;">Click on the map to get weather for that location</p>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.min.js"></script>
    <script>
        // Initialize map centered on Minnesota
        const map = L.map('map').setView([46.7296, -94.6859], 7);

        // Base layers
        const baseLayers = {
            'Topographic': L.tileLayer('https://{s}.tile.opentopomap.org/{z}/{x}/{y}.png', {
                attribution: 'OpenTopoMap',
                maxZoom: 17
            }),
            'Street Map': L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: '¬© OpenStreetMap',
                maxZoom: 19
            }),
            'Satellite': L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}', {
                attribution: 'Esri',
                maxZoom: 19
            })
        };

        baseLayers['Topographic'].addTo(map);
        
        // Add layer control in bottom-right corner
        L.control.layers(baseLayers, null, {
            position: 'bottomright',
            collapsed: false
        }).addTo(map);

        // Layer groups
        const layers = {
            nationalForest: L.layerGroup().addTo(map),
            stateForest: L.layerGroup().addTo(map),
            wilderness: L.layerGroup(),
            forestRoads: L.layerGroup().addTo(map),
            tracks: L.layerGroup().addTo(map),
            paths: L.layerGroup(),
            dispersedKnown: L.layerGroup().addTo(map),
            dispersedRisky: L.layerGroup(),
            campgrounds: L.layerGroup(),
            darkSky: L.layerGroup()
        };

        // Minnesota bounding box for queries
        const mnBounds = {
            south: 43.5,
            north: 49.4,
            west: -97.5,
            east: -89.5
        };

        // Update status
        function updateStatus(message) {
            document.getElementById('status-text').textContent = message;
        }

        // Load National Forests (Superior and Chippewa)
        function loadNationalForests() {
            const forests = [
                {
                    name: "Superior National Forest",
                    info: "3 million acres - Minnesota's largest national forest",
                    acres: "3,000,000",
                    polygon: [
                        [48.60, -90.50], [48.60, -92.60], [47.80, -92.60], 
                        [47.50, -92.20], [47.30, -91.80], [47.00, -91.20],
                        [47.00, -90.00], [47.80, -90.00], [48.60, -90.50]
                    ]
                },
                {
                    name: "Chippewa National Forest",
                    info: "666,000 acres in north-central Minnesota",
                    acres: "666,000",
                    polygon: [
                        [47.90, -95.20], [47.90, -93.60], [47.00, -93.60],
                        [47.00, -95.20], [47.90, -95.20]
                    ]
                }
            ];

            forests.forEach(forest => {
                L.polygon(forest.polygon, {
                    color: '#228B22',
                    weight: 2,
                    fillOpacity: 0.15,
                    fillColor: '#228B22'
                }).addTo(layers.nationalForest).bindPopup(`
                    <div class="info-popup">
                        <h4>üå≤ ${forest.name}</h4>
                        <p>${forest.info}</p>
                        <p><strong>${forest.acres} acres</strong></p>
                        <p>Dispersed camping generally allowed on National Forest land</p>
                        <p><small>Follow Leave No Trace principles</small></p>
                    </div>
                `);
            });
        }

        // Load State Forests
        function loadStateForests() {
            const stateForests = [
                {
                    name: "Kabetogama",
                    acres: "66,000",
                    polygon: [[48.35, -93.20], [48.35, -92.80], [48.15, -92.80], [48.15, -93.20], [48.35, -93.20]]
                },
                {
                    name: "Beltrami Island",
                    acres: "703,000",
                    polygon: [[48.70, -95.00], [48.70, -94.60], [48.40, -94.60], [48.40, -95.00], [48.70, -95.00]]
                },
                {
                    name: "Red Lake",
                    acres: "387,000",
                    polygon: [[48.20, -95.40], [48.20, -95.00], [47.90, -95.00], [47.90, -95.40], [48.20, -95.40]]
                },
                {
                    name: "Big Fork",
                    acres: "110,000",
                    polygon: [[47.85, -94.05], [47.85, -93.75], [47.65, -93.75], [47.65, -94.05], [47.85, -94.05]]
                },
                {
                    name: "Land O'Lakes",
                    acres: "150,000",
                    polygon: [[47.95, -93.25], [47.95, -92.95], [47.75, -92.95], [47.75, -93.25], [47.95, -93.25]]
                },
                {
                    name: "Finland",
                    acres: "122,000",
                    polygon: [[47.50, -91.40], [47.50, -91.10], [47.30, -91.10], [47.30, -91.40], [47.50, -91.40]]
                },
                {
                    name: "Cloquet Valley",
                    acres: "150,000",
                    polygon: [[46.65, -92.85], [46.65, -92.55], [46.45, -92.55], [46.45, -92.85], [46.65, -92.85]]
                },
                {
                    name: "Fond du Lac",
                    acres: "57,000",
                    polygon: [[46.85, -92.75], [46.85, -92.55], [46.68, -92.55], [46.68, -92.75], [46.85, -92.75]]
                },
                {
                    name: "Nemadji",
                    acres: "42,000",
                    polygon: [[46.45, -92.50], [46.45, -92.30], [46.25, -92.30], [46.25, -92.50], [46.45, -92.50]]
                },
                {
                    name: "Snake River",
                    acres: "40,000",
                    polygon: [[46.15, -93.00], [46.15, -92.80], [45.95, -92.80], [45.95, -93.00], [46.15, -93.00]]
                },
                {
                    name: "St. Croix",
                    acres: "94,000",
                    polygon: [[45.95, -92.85], [45.95, -92.65], [45.75, -92.65], [45.75, -92.85], [45.95, -92.85]]
                },
                {
                    name: "General Andrews",
                    acres: "98,000",
                    polygon: [[47.75, -94.65], [47.75, -94.35], [47.55, -94.35], [47.55, -94.65], [47.75, -94.65]]
                },
                {
                    name: "Foot Hills",
                    acres: "33,000",
                    polygon: [[46.95, -93.50], [46.95, -93.30], [46.78, -93.30], [46.78, -93.50], [46.95, -93.50]]
                },
                {
                    name: "Bear Island",
                    acres: "28,000",
                    polygon: [[47.22, -93.90], [47.22, -93.70], [47.08, -93.70], [47.08, -93.90], [47.22, -93.90]]
                },
                {
                    name: "Savanna",
                    acres: "85,000",
                    polygon: [[47.05, -93.05], [47.05, -92.85], [46.88, -92.85], [46.88, -93.05], [47.05, -93.05]]
                }
            ];

            stateForests.forEach(forest => {
                L.polygon(forest.polygon, {
                    color: '#3CB371',
                    weight: 2,
                    fillColor: '#3CB371',
                    fillOpacity: 0.15
                }).addTo(layers.stateForest).bindPopup(`
                    <div class="info-popup">
                        <h4>üå≤ ${forest.name} State Forest</h4>
                        <p>Minnesota DNR</p>
                        <p><strong>${forest.acres} acres</strong></p>
                        <p>Check DNR regulations for dispersed camping rules</p>
                    </div>
                `);
            });
        }

        // Load wilderness areas
        function loadWildernessAreas() {
            const wilderness = [
                {
                    name: "Boundary Waters Canoe Area Wilderness",
                    polygon: [
                        [48.50, -91.80], [48.50, -90.70], [47.90, -90.70],
                        [47.90, -91.80], [48.50, -91.80]
                    ],
                    info: "1 million acres - permits required"
                },
                {
                    name: "Voyageurs National Park",
                    polygon: [
                        [48.60, -93.10], [48.60, -92.50], [48.30, -92.50],
                        [48.30, -93.10], [48.60, -93.10]
                    ],
                    info: "Backcountry camping available"
                }
            ];

            wilderness.forEach(area => {
                L.polygon(area.polygon, {
                    color: '#8B0000',
                    weight: 2,
                    fillOpacity: 0.1,
                    fillColor: '#8B0000',
                    dashArray: '5, 10'
                }).addTo(layers.wilderness).bindPopup(`
                    <div class="info-popup">
                        <h4>üèîÔ∏è ${area.name}</h4>
                        <p>${area.info}</p>
                        <p><small>Special regulations and permits required</small></p>
                    </div>
                `);
            });
        }

        // Load Forest Roads from OpenStreetMap
        async function loadForestRoads() {
            try {
                updateStatus('Loading forest roads from OSM...');
                
                const overpassUrl = 'https://overpass-api.de/api/interpreter';
                
                // Forest roads query
                const roadQuery = `
                    [out:json][timeout:90];
                    (
                        way["highway"="unclassified"]["surface"~"unpaved|dirt|gravel|ground"](${mnBounds.south},${mnBounds.west},${mnBounds.north},${mnBounds.east});
                    );
                    out geom;
                `;

                const roadResponse = await fetch(overpassUrl, {
                    method: 'POST',
                    body: roadQuery
                });

                const roadData = await roadResponse.json();
                
                if (roadData.elements) {
                    roadData.elements.forEach(element => {
                        if (element.type === 'way' && element.geometry) {
                            const coords = element.geometry.map(node => [node.lat, node.lon]);
                            
                            L.polyline(coords, {
                                color: '#8B4513',
                                weight: 2,
                                opacity: 0.7
                            }).bindPopup(`
                                <div class="info-popup">
                                    <h4>Forest Road</h4>
                                    <p>Surface: ${element.tags.surface || 'unpaved'}</p>
                                    ${element.tags.name ? `<p>${element.tags.name}</p>` : ''}
                                </div>
                            `).addTo(layers.forestRoads);
                        }
                    });
                    console.log(`Loaded ${roadData.elements.length} forest roads`);
                }

                // 4WD tracks query
                const trackQuery = `
                    [out:json][timeout:90];
                    (
                        way["highway"="track"](${mnBounds.south},${mnBounds.west},${mnBounds.north},${mnBounds.east});
                    );
                    out geom;
                `;

                const trackResponse = await fetch(overpassUrl, {
                    method: 'POST',
                    body: trackQuery
                });

                const trackData = await trackResponse.json();
                
                if (trackData.elements) {
                    trackData.elements.forEach(element => {
                        if (element.type === 'way' && element.geometry) {
                            const coords = element.geometry.map(node => [node.lat, node.lon]);
                            
                            L.polyline(coords, {
                                color: '#A0522D',
                                weight: 2,
                                opacity: 0.6,
                                dashArray: '5, 5'
                            }).bindPopup(`
                                <div class="info-popup">
                                    <h4>4WD Track</h4>
                                    <p>Type: ${element.tags.tracktype || 'track'}</p>
                                    ${element.tags.name ? `<p>${element.tags.name}</p>` : ''}
                                </div>
                            `).addTo(layers.tracks);
                        }
                    });
                    console.log(`Loaded ${trackData.elements.length} tracks`);
                    updateStatus(`Loaded ${roadData.elements.length + trackData.elements.length} roads & tracks`);
                }

                // Hiking trails query
                const pathQuery = `
                    [out:json][timeout:60];
                    (
                        way["highway"="path"]["foot"="yes"](${mnBounds.south},${mnBounds.west},${mnBounds.north},${mnBounds.east});
                    );
                    out geom;
                `;

                const pathResponse = await fetch(overpassUrl, {
                    method: 'POST',
                    body: pathQuery
                });

                const pathData = await pathResponse.json();
                
                if (pathData.elements) {
                    let pathCount = 0;
                    pathData.elements.forEach(element => {
                        if (element.type === 'way' && element.geometry && pathCount < 2000) {
                            const coords = element.geometry.map(node => [node.lat, node.lon]);
                            
                            L.polyline(coords, {
                                color: '#FF6347',
                                weight: 1.5,
                                opacity: 0.5,
                                dashArray: '2, 4'
                            }).bindPopup(`
                                <div class="info-popup">
                                    <h4>Trail</h4>
                                    ${element.tags.name ? `<p>${element.tags.name}</p>` : ''}
                                    <p><small>Hiking only</small></p>
                                </div>
                            `).addTo(layers.paths);
                            pathCount++;
                        }
                    });
                    console.log(`Loaded ${pathCount} trails`);
                }

            } catch (error) {
                console.error('Error loading roads:', error);
                updateStatus('Roads loaded with some errors');
            }
        }

        // Load campgrounds from OSM
        async function loadCampgrounds() {
            try {
                const overpassUrl = 'https://overpass-api.de/api/interpreter';
                const query = `
                    [out:json][timeout:60];
                    (
                        node["tourism"="camp_site"](${mnBounds.south},${mnBounds.west},${mnBounds.north},${mnBounds.east});
                        node["tourism"="camp_pitch"](${mnBounds.south},${mnBounds.west},${mnBounds.north},${mnBounds.east});
                    );
                    out;
                `;

                const response = await fetch(overpassUrl, {
                    method: 'POST',
                    body: query
                });

                const data = await response.json();
                
                if (data.elements) {
                    data.elements.forEach(element => {
                        L.circleMarker([element.lat, element.lon], {
                            radius: 6,
                            fillColor: '#ff9933',
                            color: '#000',
                            weight: 1,
                            opacity: 1,
                            fillOpacity: 0.8
                        }).addTo(layers.campgrounds).bindPopup(`
                            <div class="info-popup">
                                <h4>üèïÔ∏è ${element.tags.name || 'Campground'}</h4>
                                ${element.tags.fee ? `<p>Fee: ${element.tags.fee}</p>` : ''}
                                ${element.tags.toilets ? `<p>Toilets available</p>` : ''}
                            </div>
                        `);
                    });
                    console.log(`Loaded ${data.elements.length} campgrounds`);
                }
            } catch (error) {
                console.error('Error loading campgrounds:', error);
            }
        }

        // KNOWN dispersed camping locations (well-documented, frequently mentioned in sources)
        function loadKnownDispersedSites() {
            const knownSites = [
                // Superior National Forest - Rustic Campgrounds (free, confirmed)
                {lat: 47.6167, lng: -91.2667, name: "Harriet Lake Rustic CG", desc: "FREE - Superior NF rustic campground with vault toilet. Former farm site with ample space. Excellent fishing on Harriet Lake.", source: "USFS Official"},
                {lat: 47.6000, lng: -91.2500, name: "Hogback Lake Rustic CG", desc: "FREE - Near Harriet Lake. Rustic with basic amenities. Good alternative if Harriet is full.", source: "USFS Official"},
                {lat: 47.5833, lng: -91.2333, name: "Whitefish Lake Rustic CG", desc: "FREE - Tofte Ranger District rustic site. Lake access for fishing and paddling.", source: "USFS Official"},
                {lat: 47.8833, lng: -91.6167, name: "Baker Lake Rustic CG", desc: "FREE - Red pine stand on Baker Lake. Has SOLAR POWERED WATER (rare for rustic sites!). Boat ramp available.", source: "USFS Official"},
                {lat: 47.8167, lng: -91.4000, name: "Cascade River Rustic CG", desc: "FREE - Superior NF near North Shore. Scenic location with water access.", source: "USFS Official"},
                
                // Echo Trail Area - Multiple confirmed dispersed sites
                {lat: 47.9833, lng: -92.3833, name: "Echo Lake Dispersed Sites", desc: "KNOWN - 3 boat-in only dispersed sites on Echo Lake. Free, first-come first-served. Access via boat ramp.", source: "Recreation.gov"},
                {lat: 47.9500, lng: -92.2500, name: "Echo Trail General Area", desc: "KNOWN - Multiple pullouts along Echo Trail (County 116). Popular dispersed camping corridor in western Superior NF.", source: "Multiple Sources"},
                
                // North Shore Area
                {lat: 47.7000, lng: -91.2000, name: "Lake Isabella Dispersed Field", desc: "KNOWN - Large open field can accommodate groups. Near Isabella. Popular spot mentioned in camping guides.", source: "TheDyrt"},
                {lat: 47.6333, lng: -91.0667, name: "Carlton Peak Dispersed Camp", desc: "KNOWN - Stunning views of Lake Superior and Sawtooth Mountains. Hike-in site. Very scenic.", source: "TheDyrt"},
                
                // Chippewa National Forest
                {lat: 47.5000, lng: -94.4500, name: "Diamond Lake Dispersed", desc: "KNOWN - Chippewa NF. Secluded lakeside camping. Small area, limited capacity but tranquil setting.", source: "TMBtent"},
                {lat: 47.6167, lng: -93.9833, name: "Marcell Dispersed Camping Area", desc: "KNOWN - Chippewa NF designated dispersed area. 3.5 hrs north of Minneapolis. Multiple sites available.", source: "Cruise America"},
                
                // Itasca County Official Dispersed Sites (DNR maintains these!)
                {lat: 47.7500, lng: -93.4167, name: "Wolf Lake Dispersed (Itasca)", desc: "OFFICIAL - Itasca County maintains this site. 3 individual sites. Can handle small-medium campers. Fire grate & latrine.", source: "Itasca County Parks"},
                {lat: 47.6833, lng: -93.2667, name: "Crooked Lake Dispersed (Itasca)", desc: "OFFICIAL - 3 sites total. Two sites on old logging road best for tents. Road rough in wet conditions.", source: "Itasca County Parks"},
                {lat: 47.5500, lng: -91.8333, name: "Erskine Lake Dispersed (Itasca)", desc: "OFFICIAL - One tent site. Designated trout lake. Fair road conditions.", source: "Itasca County Parks"},
                {lat: 47.5333, lng: -93.3500, name: "Island / Hay Lake Dispersed (Itasca)", desc: "OFFICIAL - One site for small-medium camper. Maintained by Itasca County.", source: "Itasca County Parks"},
                {lat: 47.7000, lng: -93.5667, name: "Kelly Lake Dispersed (Itasca)", desc: "OFFICIAL - One site for medium-large camper. Fair to good road conditions.", source: "Itasca County Parks"},
                
                // State Forests with confirmed access
                {lat: 46.0500, lng: -93.2500, name: "Rum River State Forest", desc: "KNOWN - NW of Twin Cities. Multiple pullouts along forest roads. Popular weekend destination. Bring bug spray!", source: "TMBtent"},
                {lat: 47.5167, lng: -91.3333, name: "Finland State Forest Area", desc: "KNOWN - North shore access. Forest roads with dispersed opportunities. Beautiful area near Lake Superior.", source: "Multiple Sources"}
            ];

            const knownIcon = L.divIcon({
                html: '‚õ∫',
                className: 'camp-icon-known',
                iconSize: [28, 28],
                iconAnchor: [14, 28]
            });

            knownSites.forEach(site => {
                L.marker([site.lat, site.lng], {icon: knownIcon})
                    .addTo(layers.dispersedKnown)
                    .bindPopup(`
                        <div class="info-popup">
                            <h4 style="color: #2c5f2d;">‚õ∫ ${site.name}</h4>
                            <p><strong>${site.desc}</strong></p>
                            <p style="font-size: 11px; color: #666; margin-top: 6px;"><em>Source: ${site.source}</em></p>
                            <p style="font-size: 10px; margin-top: 8px; padding: 6px; background: #e8f5e9; border-radius: 4px;"><strong>‚úì KNOWN SITE:</strong> Well-documented with confirmed access</p>
                        </div>
                    `);
            });
            
            console.log(`Loaded ${knownSites.length} KNOWN dispersed camping sites`);
        }

        // RISKY dispersed camping locations (possible but limited information - verify first!)
        function loadRiskyDispersedSites() {
            const riskySites = [
                {lat: 47.7500, lng: -91.9500, name: "Fernberg Road (FR 377)", desc: "RISKY - Historic dispersed camping road. Multiple pullouts reported but specific sites not well-documented. 4WD recommended.", warning: "Verify current access"},
                {lat: 47.4500, lng: -91.1000, name: "Sawbill Trail Area", desc: "RISKY - Forest roads off Sawbill Trail may have dispersed sites. Limited recent information. Scout before dark.", warning: "Limited documentation"},
                {lat: 48.4000, lng: -92.8000, name: "Lax Lake Area Dispersed", desc: "RISKY - State land near Lax Lake. Mentioned in forums but specifics unclear. Very remote.", warning: "Scout carefully"},
                {lat: 47.8000, lng: -91.1000, name: "Blackstone Lake Area", desc: "RISKY - Backpack campsite area may have car-accessible dispersed nearby. Needs verification.", warning: "Verify access"},
                {lat: 48.2000, lng: -94.8000, name: "Beltrami Island Remote Areas", desc: "RISKY - Vast state forest with potential. VERY remote - prepare accordingly. Limited services.", warning: "Extremely remote"},
                {lat: 47.9000, lng: -95.1000, name: "Red Lake State Forest Roads", desc: "RISKY - Large state forest with logging roads. Dispersed camping allowed but sites not mapped. Explore carefully.", warning: "Sites not mapped"},
                {lat: 46.8000, lng: -92.6000, name: "Fond du Lac SF Roads", desc: "RISKY - State forest roads may have pullouts. Near trails. Specific sites not documented.", warning: "Scout first"},
                {lat: 46.3000, lng: -92.4000, name: "Nemadji State Forest", desc: "RISKY - Southern dispersed options exist per DNR but not well known. Less used than northern forests.", warning: "Less documentation"},
                {lat: 47.2000, lng: -94.2000, name: "Chippewa NF Side Roads", desc: "RISKY - Away from main roads. Forest service roads that may have sites. Explore with MVUM map.", warning: "Use MVUM to verify"},
                {lat: 46.6000, lng: -92.7000, name: "Cloquet Valley SF", desc: "RISKY - State forest allows dispersed camping. Specific good sites not well publicized. Logging roads present.", warning: "Limited info"}
            ];

            const riskyIcon = L.divIcon({
                html: '‚ö†Ô∏è',
                className: 'camp-icon-risky',
                iconSize: [28, 28],
                iconAnchor: [14, 28]
            });

            riskySites.forEach(site => {
                L.marker([site.lat, site.lng], {icon: riskyIcon})
                    .addTo(layers.dispersedRisky)
                    .bindPopup(`
                        <div class="info-popup">
                            <h4 style="color: #d97706;">‚ö†Ô∏è ${site.name}</h4>
                            <p>${site.desc}</p>
                            <p style="font-size: 10px; margin-top: 8px; padding: 6px; background: #fef3c7; border-radius: 4px; border-left: 3px solid #f59e0b;"><strong>‚ö†Ô∏è RISKY SITE:</strong> ${site.warning}. Scout in daylight. Have backup plan. Check current regulations.</p>
                            <p style="font-size: 10px; margin-top: 6px;"><em>Always verify access before dark!</em></p>
                        </div>
                    `);
            });
            
            console.log(`Loaded ${riskySites.length} RISKY dispersed camping sites`);
        }

        // Dark sky areas
        function loadDarkSky() {
            const darkSkyZones = [
                {center: [47.95, -91.5], radius: 70000, name: "Superior National Forest Dark Sky", quality: "Bortle Class 2 (Excellent)"},
                {center: [48.5, -94.8], radius: 55000, name: "Beltrami Island Dark Sky", quality: "Bortle Class 2 (Excellent)"},
                {center: [48.2, -93.0], radius: 45000, name: "Kabetogama Dark Sky", quality: "Bortle Class 3 (Very Good)"},
                {center: [47.4, -94.4], radius: 40000, name: "Chippewa NF Dark Sky", quality: "Bortle Class 3 (Very Good)"}
            ];

            darkSkyZones.forEach(zone => {
                L.circle(zone.center, {
                    color: '#191970',
                    fillColor: '#000033',
                    fillOpacity: 0.2,
                    radius: zone.radius,
                    weight: 2
                }).addTo(layers.darkSky).bindPopup(`
                    <div class="info-popup">
                        <h4>üåå ${zone.name}</h4>
                        <p>${zone.quality}</p>
                        <p>Minimal light pollution - excellent for stargazing and astrophotography</p>
                        <p><small>Best on moonless nights away from towns</small></p>
                    </div>
                `);
            });
        }

        // Layer controls
        document.getElementById('layer-national-forest').addEventListener('change', (e) => {
            e.target.checked ? map.addLayer(layers.nationalForest) : map.removeLayer(layers.nationalForest);
        });

        document.getElementById('layer-state-forest').addEventListener('change', (e) => {
            e.target.checked ? map.addLayer(layers.stateForest) : map.removeLayer(layers.stateForest);
        });

        document.getElementById('layer-wilderness').addEventListener('change', (e) => {
            e.target.checked ? map.addLayer(layers.wilderness) : map.removeLayer(layers.wilderness);
        });

        document.getElementById('layer-forest-roads').addEventListener('change', (e) => {
            e.target.checked ? map.addLayer(layers.forestRoads) : map.removeLayer(layers.forestRoads);
        });

        document.getElementById('layer-tracks').addEventListener('change', (e) => {
            e.target.checked ? map.addLayer(layers.tracks) : map.removeLayer(layers.tracks);
        });

        document.getElementById('layer-paths').addEventListener('change', (e) => {
            e.target.checked ? map.addLayer(layers.paths) : map.removeLayer(layers.paths);
        });

        document.getElementById('layer-dispersed-known').addEventListener('change', (e) => {
            e.target.checked ? map.addLayer(layers.dispersedKnown) : map.removeLayer(layers.dispersedKnown);
        });

        document.getElementById('layer-dispersed-risky').addEventListener('change', (e) => {
            e.target.checked ? map.addLayer(layers.dispersedRisky) : map.removeLayer(layers.dispersedRisky);
        });

        document.getElementById('layer-campgrounds').addEventListener('change', (e) => {
            e.target.checked ? map.addLayer(layers.campgrounds) : map.removeLayer(layers.campgrounds);
        });

        document.getElementById('layer-dark-sky').addEventListener('change', (e) => {
            e.target.checked ? map.addLayer(layers.darkSky) : map.removeLayer(layers.darkSky);
        });

        // Weather functionality
        let weatherPanelVisible = false;
        
        document.getElementById('weather-toggle').addEventListener('click', () => {
            weatherPanelVisible = !weatherPanelVisible;
            const panel = document.getElementById('weather-panel');
            if (weatherPanelVisible) {
                panel.classList.add('active');
                document.getElementById('weather-toggle').textContent = 'Hide Weather Forecast';
            } else {
                panel.classList.remove('active');
                document.getElementById('weather-toggle').textContent = 'Show Weather Forecast';
            }
        });

        map.on('click', async (e) => {
            if (weatherPanelVisible) {
                await fetchWeather(e.latlng.lat, e.latlng.lng);
            }
        });

        async function fetchWeather(lat, lon) {
            const weatherContent = document.getElementById('weather-content');
            weatherContent.innerHTML = '<p style="font-size: 11px;">Loading weather...</p>';
            
            try {
                const response = await fetch(
                    `https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&daily=temperature_2m_max,temperature_2m_min,precipitation_sum,weathercode,windspeed_10m_max&temperature_unit=fahrenheit&timezone=America%2FChicago&forecast_days=3`
                );
                
                if (!response.ok) throw new Error('Weather fetch failed');
                
                const data = await response.json();
                
                const weatherCodes = {
                    0: '‚òÄÔ∏è Clear', 1: 'üå§Ô∏è Mostly Clear', 2: '‚õÖ Partly Cloudy', 3: '‚òÅÔ∏è Cloudy',
                    45: 'üå´Ô∏è Foggy', 48: 'üå´Ô∏è Foggy', 51: 'üå¶Ô∏è Light Rain', 53: 'üåßÔ∏è Rain',
                    55: 'üåßÔ∏è Heavy Rain', 61: 'üå¶Ô∏è Light Rain', 63: 'üåßÔ∏è Rain', 65: 'üåßÔ∏è Heavy Rain',
                    71: 'üå®Ô∏è Light Snow', 73: '‚ùÑÔ∏è Snow', 75: '‚ùÑÔ∏è Heavy Snow', 80: 'üå¶Ô∏è Showers',
                    95: '‚õàÔ∏è Thunderstorm'
                };
                
                let weatherHTML = '';
                for (let i = 0; i < 3; i++) {
                    const date = new Date(data.daily.time[i]);
                    const dayName = date.toLocaleDateString('en-US', { weekday: 'short', month: 'short', day: 'numeric' });
                    const weather = weatherCodes[data.daily.weathercode[i]] || 'üå°Ô∏è Variable';
                    const high = Math.round(data.daily.temperature_2m_max[i]);
                    const low = Math.round(data.daily.temperature_2m_min[i]);
                    const precip = data.daily.precipitation_sum[i];
                    const wind = Math.round(data.daily.windspeed_10m_max[i]);
                    
                    weatherHTML += `
                        <div class="weather-day">
                            <strong>${dayName}</strong><br>
                            ${weather}<br>
                            ${high}¬∞F / ${low}¬∞F<br>
                            Wind: ${wind} mph<br>
                            ${precip > 0 ? `Precip: ${precip.toFixed(1)}"` : 'Dry'}
                        </div>
                    `;
                }
                
                weatherContent.innerHTML = weatherHTML;
            } catch (error) {
                weatherContent.innerHTML = '<p style="font-size: 11px; color: red;">Weather unavailable</p>';
            }
        }

        // Initialize
        L.control.scale({imperial: true, metric: true}).addTo(map);

        async function initializeMap() {
            console.log('Loading map data...');
            updateStatus('Initializing map...');
            
            loadNationalForests();
            loadStateForests();
            loadWildernessAreas();
            loadKnownDispersedSites();
            loadRiskyDispersedSites();
            loadDarkSky();
            
            await loadForestRoads();
            await loadCampgrounds();
            
            updateStatus('‚úÖ Map ready!');
            console.log('Map initialization complete');
        }

        initializeMap();

        // User location
        map.locate({setView: false, maxZoom: 12});
        
        map.on('locationfound', (e) => {
            L.circle(e.latlng, {
                radius: e.accuracy / 2,
                color: '#4285F4',
                fillColor: '#4285F4',
                fillOpacity: 0.2
            }).addTo(map);
            
            L.marker(e.latlng).addTo(map).bindPopup('üìç Your Location').openPopup();
        });
    </script>
</body>
</html>